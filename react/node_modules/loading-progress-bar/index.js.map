{"version":3,"file":"index.js","sources":["../node_modules/@web-companions/fc/utils.js","../node_modules/@web-companions/fc/hooks.js","../src/index.tsx","../node_modules/@web-companions/fc/sdk/element.js"],"sourcesContent":["export function isFn(v){return\"function\"==typeof v}export function fnWrap(fnOrO,args){return isFn(fnOrO)?fnOrO.apply(null,args):fnOrO}export function defMapper(state,key,value){return void 0===state||value!==state[key]?{...state,[key]:value}:state}","import{fnWrap}from\"./utils\";const buckets=new WeakMap,afStack=[];function getCurrentBucket(){const af=afStack[afStack.length-1],bucket=buckets.get(af);if(void 0!==bucket)return bucket;throw new Error(\"Hooks only valid inside an Articulated Function or a Custom Hook.\")}function guardsChanged(guards1,guards2){if(void 0===guards1||void 0===guards2)return!0;if(guards1.length!==guards2.length)return!0;for(const[idx,guard]of guards1.entries())if(!Object.is(guard,guards2[idx]))return!0;return!1}export function AF(fns,cb){return af.reset=function(){afStack.push(af);const bucket=getCurrentBucket();try{for(let cleanup of bucket.c)fnWrap(cleanup)}finally{afStack.pop(),bucket.sS.length=0,bucket.e.length=0,bucket.c.length=0,bucket.m.length=0,bucket.nSSI=0,bucket.nEI=0,bucket.nMI=0}},af;function af(...args){afStack.push(af);let r,bucket=buckets.get(af);null==bucket?(bucket={nSSI:0,nEI:0,nMI:0,sS:[],e:[],c:[],m:[],hUS:!1,cb:cb,af:()=>af(...args)},buckets.set(af,bucket)):(bucket.nSSI=0,bucket.nEI=0,bucket.nMI=0,bucket.af=()=>af(...args));try{r=fns.apply(this,args)}finally{try{return function(bucket){for(let[idx,[effect]]of bucket.e.entries())try{fnWrap(effect)}finally{bucket.e[idx][0]=void 0}}(bucket),bucket.cb(r)}finally{bucket.hUS&&(bucket.hUS=!1,bucket.af()),afStack.pop()}}}}export function useState(initialVal){return useReducer((function(prevVal,vOrFn){return fnWrap(vOrFn,[prevVal])}),initialVal)}export function useReducer(reducer,initialVal,...initialReduction){var bucket=getCurrentBucket();if(!(bucket.nSSI in bucket.sS)){let slot=[fnWrap(initialVal),function(v){slot[0]=reducer(slot[0],v),afStack.length>0?bucket.hUS=!0:bucket.af()}];bucket.sS[bucket.nSSI]=slot,initialReduction.length>0&&bucket.sS[bucket.nSSI][1](initialReduction[0])}return[...bucket.sS[bucket.nSSI++]]}export function useEffect(fn,...guards){guards.length>0?1==guards.length&&Array.isArray(guards[0])&&(guards=guards[0]):guards=void 0;const bucket=getCurrentBucket();bucket.nEI in bucket.e||(bucket.e[bucket.nEI]=[]);let effectIdx=bucket.nEI,effect=bucket.e[effectIdx];guardsChanged(effect[1],guards)&&(effect[0]=function(){try{fnWrap(bucket.c[effectIdx])}finally{bucket.c[effectIdx]=void 0}var ret=fn();\"function\"==typeof ret&&(bucket.c[effectIdx]=ret)},effect[1]=guards),bucket.nEI++}export function useMemo(fn,...inputGuards){inputGuards.length>0?1==inputGuards.length&&Array.isArray(inputGuards[0])&&(inputGuards=inputGuards[0]):inputGuards=[fn];const bucket=getCurrentBucket();bucket.nMI in bucket.m||(bucket.m[bucket.nMI]=[]);const memoization=bucket.m[bucket.nMI];if(guardsChanged(memoization[1],inputGuards))try{memoization[0]=fn()}finally{memoization[1]=inputGuards}return bucket.nMI++,memoization[0]}export function useCallback(fn,...inputGuards){return useMemo((function(){return fn}),...inputGuards)}export function useRef(initialValue){var[ref]=useState({current:initialValue});return ref}","import { EG, useState, useEffect } from '@web-companions/fc';\nimport type { TypeConstructor } from '@web-companions/fc/common.model';\n\nconst html = String.raw;\nconst css = String.raw;\n\nexport interface LoadingProgressBarConfig {\n  stepsCount: number; // (1 by default)\n  duration: number; // ms (2000ms by default)\n}\n\nexport interface LoadingProgressBarHTMLElement extends HTMLElement {\n  generateProgress?: Generator;\n  togglePause?: (isPause?: boolean) => void;\n  ref?: { current?: any };\n  config?: LoadingProgressBarConfig;\n}\n\nexport const loadingProgressBar = EG({\n  props: {\n    config: {\n      type: {} as TypeConstructor<LoadingProgressBarConfig>,\n      default: {\n        duration: 2000,\n        stepsCount: 1,\n      },\n    },\n    color: {\n      type: String,\n      attribute: 'color',\n      default: '#ef534e',\n    },\n  },\n  render: (t: { template: string; style: string }, c) => {\n    const inner = (c as ShadowRoot).innerHTML;\n    if (inner !== t.template) {\n      (c as ShadowRoot).innerHTML = t.template;\n    }\n\n    const sheet = new CSSStyleSheet();\n    sheet['replaceSync'](t.style);\n    (c as ShadowRoot)['adoptedStyleSheets'] = [sheet];\n  },\n  shadow: {\n    mode: 'open',\n  },\n})(function (this: LoadingProgressBarHTMLElement, props) {\n  const [isPause, setIsPause] = useState(false);\n  const [keyframes, setKeyframes] = useState();\n  const [animationName, setAnimationName] = useState();\n  const animationDuration = props.config.duration;\n\n  useEffect(() => {\n    const stepsCount = props.config.stepsCount;\n    const k = 100 / stepsCount;\n\n    let _keyframes = '';\n    for (let i = 0; i < stepsCount; i++) {\n      const keyframeName = ` loadingPB_${i * k}`;\n      _keyframes =\n        _keyframes +\n        ' ' +\n        css`\n          /* clean-css ignore:start */\n          @keyframes ${keyframeName} {\n            from {\n              width: ${i * k + '%'};\n            }\n            to {\n              width: ${(i + 1) * k + '%'};\n            }\n          }\n          /* clean-css ignore:end */\n        `;\n    }\n    setKeyframes(_keyframes);\n\n    let index = 0;\n    const generator = function* () {\n      while (true) {\n        if (index < stepsCount) {\n          setAnimationName(`loadingPB_${index * k}`);\n          yield ++index;\n        } else {\n          setIsPause(false);\n          setAnimationName(undefined);\n          index = 0;\n          yield index;\n        }\n      }\n    };\n\n    this.ref = this.ref || {};\n    this.ref.current = this;\n    this.generateProgress = generator();\n    this.togglePause = (pause?: boolean) => setIsPause((hasPause) => (typeof pause === 'boolean' ? pause : !hasPause));\n  }, [props.config]);\n\n  return {\n    style: css`\n      /* dynamic keyframes */\n      ${keyframes}\n\n      .lpb {\n        animation-timing-function: cubic-bezier(0.55, 0, 1, 0.45);\n        animation-fill-mode: both;\n        background: ${props.color};\n        height: 3px;\n        left: 0;\n        top: 0;\n        width: 0%;\n        z-index: 9999;\n        position: fixed;\n        animation-name: ${animationName};\n        animation-duration: ${animationDuration + 'ms'};\n        animation-play-state: ${isPause ? 'paused' : 'running'};\n      }\n\n      .lpb:after {\n        display: ${animationName !== undefined ? 'block' : 'none'};\n        position: absolute;\n        content: '';\n        right: 0px;\n        width: 100px;\n        height: 100%;\n        box-shadow: ${`0 0 10px ${props.color}, 0 0 5px ${props.color}`};\n        opacity: 1;\n        transform: rotate(3deg) translate(0px, -4px);\n      }\n    `,\n    template: <div class=\"lpb\"></div>,\n  };\n});\n","import{AF}from\"../hooks\";import{defMapper}from\"../utils\";export function EG(config){const mapper=config.mapper||defMapper;return func=>{const element=build(func,config.props||{},config.render,mapper,config.shadow);return(name,options)=>{try{customElements.define(name,element,options)}catch(e){console.warn(e)}const component=async _p=>customElements.whenDefined(name).then(()=>customElements.get(name));return component.element=element,component.adapter=(func,defaultProps)=>func(name,defaultProps),component}}}function build(func,props,render,mapper,shadow){var _a;const customEl=((_a=class extends HTMLElement{constructor(){super(),this._props={};const ctr=void 0!==shadow?this.attachShadow(shadow):this;this.aFunc=AF(func,r=>render(r,ctr));for(const pK in props){const pV=props[pK];let attr=void 0;\"type\"in pV&&(this.props[pK]=pV.default,attr=pV.attribute),Reflect.defineProperty(this,pK,{get:()=>this.props[pK],set:value=>{this.props=mapper.apply(this,[this.props,pK,value,attr])},enumerable:!0})}}static get observedAttributes(){return Object.values(this.attributes)}set props(newProps){void 0!==newProps&&this.props!==newProps&&(this._props=newProps,this.render())}get props(){return this._props}connectedCallback(){this.render()}attributeChangedCallback(name,oldValue,newValue){if(oldValue!==newValue)for(const[attrKey,attrName]of Object.entries(this.constructor.attributes))if(attrName===name&&this[attrKey]!==newValue){this[attrKey]=newValue;break}}render(){this.isConnected&&Reflect.apply(this.aFunc,this,[this.props])}}).attributes={},_a),attributes=Reflect.get(customEl,\"attributes\");for(const pK in props){const pV=props[pK];\"type\"in pV&&void 0!==pV.attribute&&Reflect.defineProperty(customEl,\"attributes\",{value:{...attributes,[pK]:pV.attribute},enumerable:!0,writable:!0})}return customEl}"],"names":["fnWrap","fnOrO","args","apply","defMapper","state","key","value","[object Object]","buckets","WeakMap","afStack","getCurrentBucket","af","length","bucket","get","Error","useState","initialVal","reducer","initialReduction","nSSI","sS","slot","v","hUS","useReducer","prevVal","vOrFn","useEffect","fn","guards","Array","isArray","nEI","e","effectIdx","effect","guards1","guards2","idx","guard","entries","Object","is","guardsChanged","c","ret","html","String","raw","css","loadingProgressBar","config","mapper","func","element","props","render","shadow","_a","customEl","HTMLElement","super","this","_props","ctr","attachShadow","aFunc","fns","cb","reset","push","cleanup","pop","m","nMI","r","set","AF","pK","pV","attr","default","attribute","Reflect","defineProperty","enumerable","observedAttributes","values","attributes","newProps","name","oldValue","newValue","attrKey","attrName","constructor","isConnected","writable","build","options","customElements","define","console","warn","component","async","whenDefined","then","adapter","defaultProps","EG","type","duration","stepsCount","color","t","innerHTML","template","sheet","CSSStyleSheet","style","mode","isPause","setIsPause","keyframes","setKeyframes","animationName","setAnimationName","animationDuration","k","_keyframes","i","ref"],"mappings":"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"}